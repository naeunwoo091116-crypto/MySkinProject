services:
  # Web Service (Flask App)
  - type: web
    name: myskin-web
    env: python
    region: singapore
    plan: free
    buildCommand: "pip install -r requirements_render.txt"
    startCommand: "gunicorn -b 0.0.0.0:$PORT app_render:app --workers 2 --timeout 120"
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.0
      - key: GPU_SERVER_URL
        sync: false  # 수동으로 설정 필요
      - key: GPU_API_KEY
        sync: false  # 선택사항
      - key: DATABASE_URL
        fromDatabase:
          name: myskin-db
          property: connectionString

  # PostgreSQL Database
  - type: pserv
    name: myskin-db
    env: docker
    region: singapore
    plan: free
    image:
      url: postgres:15-alpine
    disk:
      name: myskin-data
      mountPath: /var/lib/postgresql/data
      sizeGB: 1
    envVars:
      - key: POSTGRES_USER
        value: postgres
      - key: POSTGRES_PASSWORD
        generateValue: true
      - key: POSTGRES_DB
        value: myskin
